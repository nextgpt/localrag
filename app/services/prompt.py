# ğŸ¯ æ‹›æ ‡ä¹¦ä¸“ç”¨æç¤ºè¯æ¨¡æ¿ - 99%ç²¾å‡†åº¦ä¸“ä¸šè§£è¯»

TENDER_ANALYSIS_PROMPTS = {
    "project_info": """
# æ‹›æ ‡ä¹¦é¡¹ç›®ä¿¡æ¯åˆ†æä¸“å®¶ - 99%ç²¾å‡†åº¦è¦æ±‚

ä½ æ˜¯ä¸€ä½èµ„æ·±çš„æ‹›æ ‡æ–‡ä»¶åˆ†æä¸“å®¶ï¼Œå…·æœ‰15å¹´çš„å·¥ç¨‹æ‹›æ ‡ç»éªŒã€‚è¯·åŸºäºä»¥ä¸‹æ£€ç´¢ç»“æœï¼Œå¯¹æ‹›æ ‡ä¹¦ä¸­çš„é¡¹ç›®åŸºæœ¬ä¿¡æ¯è¿›è¡Œç²¾ç¡®åˆ†æã€‚

## åˆ†æè¦æ±‚
1. **é¡¹ç›®æ€§è´¨è¯†åˆ«**ï¼šå‡†ç¡®è¯†åˆ«å·¥ç¨‹ç±»å‹ã€å»ºè®¾æ€§è´¨ã€é¡¹ç›®è§„æ¨¡
2. **å·¥æœŸè¦æ±‚æå–**ï¼šç²¾ç¡®æå–æ–½å·¥å‘¨æœŸã€å…³é”®èŠ‚ç‚¹ã€é‡Œç¨‹ç¢‘æ—¶é—´
3. **æˆªæ ‡æ—¶é—´ç¡®å®š**ï¼šæ˜ç¡®æŠ•æ ‡æˆªæ­¢æ—¶é—´ã€å¼€æ ‡æ—¶é—´ã€è¯„æ ‡æ—¶é—´
4. **åœ°ç†ä¿¡æ¯å®šä½**ï¼šå‡†ç¡®è¯†åˆ«å»ºè®¾åœ°ç‚¹ã€æ–½å·¥èŒƒå›´ã€åœ°ç†æ¡ä»¶

## è¾“å‡ºæ ¼å¼è¦æ±‚
è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¾“å‡ºï¼š

```json
{
    "project_overview": {
        "name": "é¡¹ç›®å®Œæ•´åç§°",
        "type": "å·¥ç¨‹ç±»å‹ï¼ˆå¦‚ï¼šå»ºç­‘å·¥ç¨‹/å¸‚æ”¿å·¥ç¨‹/æ°´åˆ©å·¥ç¨‹ï¼‰",
        "nature": "å»ºè®¾æ€§è´¨ï¼ˆå¦‚ï¼šæ–°å»º/æ”¹å»º/æ‰©å»ºï¼‰", 
        "scale": "å»ºè®¾è§„æ¨¡æè¿°",
        "location": "è¯¦ç»†å»ºè®¾åœ°ç‚¹",
        "investment": "æ€»æŠ•èµ„é‡‘é¢ï¼ˆå¦‚æœ‰ï¼‰"
    },
    "schedule_requirements": {
        "construction_period": "æ–½å·¥å·¥æœŸï¼ˆå¤©æ•°ï¼‰",
        "start_conditions": "å¼€å·¥æ¡ä»¶è¦æ±‚",
        "completion_deadline": "ç«£å·¥æ—¥æœŸè¦æ±‚",
        "milestones": ["å…³é”®é‡Œç¨‹ç¢‘èŠ‚ç‚¹åˆ—è¡¨"],
        "special_time_requirements": "ç‰¹æ®Šæ—¶é—´è¦æ±‚"
    },
    "bidding_timeline": {
        "bid_submission_deadline": "æŠ•æ ‡æˆªæ­¢æ—¶é—´",
        "bid_opening_time": "å¼€æ ‡æ—¶é—´",
        "evaluation_period": "è¯„æ ‡å‘¨æœŸ",
        "result_announcement": "ç»“æœå…¬å¸ƒæ—¶é—´",
        "contract_signing": "åˆåŒç­¾è®¢æ—¶é—´è¦æ±‚"
    },
    "confidence_assessment": {
        "information_completeness": "0.0-1.0åˆ†æ•°",
        "accuracy_confidence": "0.0-1.0åˆ†æ•°",
        "missing_items": ["ç¼ºå¤±çš„å…³é”®ä¿¡æ¯åˆ—è¡¨"]
    }
}
```

## æ£€ç´¢å†…å®¹
{search_results}

## é‡è¦æç¤º
- å¿…é¡»åŸºäºæ£€ç´¢ç»“æœä¸­çš„å®é™…å†…å®¹ï¼Œä¸å¾—ç¼–é€ ä¿¡æ¯
- å¦‚æœæŸé¡¹ä¿¡æ¯æœªæ‰¾åˆ°ï¼Œè¯·åœ¨å¯¹åº”å­—æ®µä¸­æ ‡æ³¨"æœªæ˜ç¡®è¯´æ˜"
- æ—¥æœŸæ—¶é—´å¿…é¡»ç²¾ç¡®åˆ°å¹´æœˆæ—¥æ—¶åˆ†ï¼ˆå¦‚æœ‰ï¼‰
- é‡‘é¢æ•°å­—å¿…é¡»å‡†ç¡®ï¼ŒåŒ…å«å•ä½
- ç½®ä¿¡åº¦è¯„ä¼°å¿…é¡»å®¢è§‚çœŸå®

è¯·å¼€å§‹åˆ†æï¼š
""",

    "technical_specs": """
# æ‹›æ ‡ä¹¦æŠ€æœ¯è§„èŒƒåˆ†æä¸“å®¶ - 99%ç²¾å‡†åº¦è¦æ±‚

ä½ æ˜¯ä¸€ä½æŠ€æœ¯è§„èŒƒå®¡æŸ¥ä¸“å®¶ï¼Œå…·æœ‰ä¸°å¯Œçš„å·¥ç¨‹æŠ€æœ¯æ ‡å‡†åˆ†æç»éªŒã€‚è¯·å¯¹æ‹›æ ‡ä¹¦ä¸­çš„æŠ€æœ¯è¦æ±‚è¿›è¡Œå…¨é¢ã€ç²¾ç¡®çš„åˆ†æã€‚

## åˆ†æç›®æ ‡
1. **æŠ€æœ¯æ ‡å‡†è¯†åˆ«**ï¼šæ˜ç¡®é€‚ç”¨çš„å›½å®¶æ ‡å‡†ã€è¡Œä¸šæ ‡å‡†ã€åœ°æ–¹æ ‡å‡†
2. **è´¨é‡ç­‰çº§ç¡®å®š**ï¼šå‡†ç¡®è¯†åˆ«å·¥ç¨‹è´¨é‡ç­‰çº§è¦æ±‚
3. **ææ–™è®¾å¤‡è§„èŒƒ**ï¼šè¯¦ç»†åˆ—å‡ºææ–™è®¾å¤‡çš„è§„æ ¼ã€å“ç‰Œã€æ€§èƒ½è¦æ±‚
4. **æ–½å·¥å·¥è‰ºè¦æ±‚**ï¼šæå–å…³é”®æ–½å·¥æ–¹æ³•ã€å·¥è‰ºæ ‡å‡†ã€éªŒæ”¶è¦æ±‚

## è¾“å‡ºæ ¼å¼è¦æ±‚
```json
{
    "technical_standards": {
        "applicable_codes": ["é€‚ç”¨è§„èŒƒæ ‡å‡†åˆ—è¡¨"],
        "quality_grade": "è´¨é‡ç­‰çº§è¦æ±‚",
        "performance_requirements": "æ€§èƒ½æŒ‡æ ‡è¦æ±‚",
        "acceptance_criteria": "éªŒæ”¶æ ‡å‡†"
    },
    "material_requirements": {
        "main_materials": [
            {
                "category": "ææ–™ç±»åˆ«",
                "specifications": "è§„æ ¼è¦æ±‚",
                "brands": "å“ç‰Œè¦æ±‚ï¼ˆå¦‚æœ‰ï¼‰",
                "standards": "é€‚ç”¨æ ‡å‡†",
                "quantity": "éœ€æ±‚é‡ï¼ˆå¦‚æœ‰ï¼‰"
            }
        ],
        "prohibited_materials": ["ç¦ç”¨ææ–™åˆ—è¡¨"],
        "alternative_materials": "æ›¿ä»£ææ–™è¯´æ˜"
    },
    "equipment_requirements": {
        "main_equipment": [
            {
                "type": "è®¾å¤‡ç±»å‹",
                "specifications": "æŠ€æœ¯è§„æ ¼",
                "performance": "æ€§èƒ½è¦æ±‚",
                "brands": "å“ç‰Œè¦æ±‚ï¼ˆå¦‚æœ‰ï¼‰",
                "certification": "è®¤è¯è¦æ±‚"
            }
        ],
        "testing_equipment": "æ£€æµ‹è®¾å¤‡è¦æ±‚",
        "safety_equipment": "å®‰å…¨è®¾å¤‡è¦æ±‚"
    },
    "construction_methods": {
        "key_processes": ["å…³é”®å·¥è‰ºæµç¨‹"],
        "prohibited_methods": ["ç¦æ­¢ä½¿ç”¨çš„æ–¹æ³•"],
        "special_requirements": "ç‰¹æ®Šå·¥è‰ºè¦æ±‚",
        "quality_control": "è´¨é‡æ§åˆ¶æªæ–½"
    },
    "risk_assessment": {
        "technical_risks": ["æŠ€æœ¯é£é™©ç‚¹"],
        "compliance_risks": ["åˆè§„é£é™©ç‚¹"],
        "implementation_difficulty": "å®æ–½éš¾åº¦è¯„ä¼°ï¼ˆ1-5çº§ï¼‰"
    }
}
```

## æ£€ç´¢å†…å®¹
{search_results}

è¯·åŸºäºå®é™…æ£€ç´¢å†…å®¹è¿›è¡Œå‡†ç¡®åˆ†æï¼š
""",

    "commercial_terms": """
# æ‹›æ ‡ä¹¦å•†åŠ¡æ¡æ¬¾åˆ†æä¸“å®¶ - 99%ç²¾å‡†åº¦è¦æ±‚

ä½ æ˜¯ä¸€ä½èµ„æ·±çš„å·¥ç¨‹å•†åŠ¡ä¸“å®¶ï¼Œå…·æœ‰æ·±åšçš„åˆåŒæ³•å¾‹çŸ¥è¯†å’Œä¸°å¯Œçš„å•†åŠ¡è°ˆåˆ¤ç»éªŒã€‚è¯·å¯¹æ‹›æ ‡ä¹¦ä¸­çš„å•†åŠ¡æ¡æ¬¾è¿›è¡Œè¯¦ç»†åˆ†æã€‚

## åˆ†æè¦æ±‚
1. **æŠ•æ ‡äººè´£ä»»ç•Œå®š**ï¼šæ˜ç¡®æŠ•æ ‡äººçš„ä¹‰åŠ¡ã€è´£ä»»èŒƒå›´ã€é£é™©æ‰¿æ‹…
2. **å·¥ä½œèŒƒå›´ç¡®å®š**ï¼šè¯¦ç»†åˆ—å‡ºåŒ…å«å’Œä¸åŒ…å«çš„å·¥ä½œå†…å®¹
3. **æŠ¥ä»·è¦æ±‚è§£è¯»**ï¼šåˆ†ææŠ¥ä»·å½¢å¼ã€è®¡ä»·æ–¹å¼ã€ä»·æ ¼æ„æˆ
4. **æŠ•æ ‡ä¹¦ç¼–åˆ¶è¦æ±‚**ï¼šæå–æŠ•æ ‡æ–‡ä»¶çš„æ ¼å¼ã€å†…å®¹ã€æäº¤è¦æ±‚

## è¾“å‡ºæ ¼å¼è¦æ±‚
```json
{
    "bidder_responsibilities": {
        "scope_of_work": "å·¥ä½œèŒƒå›´è¯¦ç»†æè¿°",
        "exclusions": "ä¸åŒ…å«çš„å·¥ä½œå†…å®¹",
        "risk_allocation": "é£é™©åˆ†é…è¯´æ˜",
        "liability_limits": "è´£ä»»é™åˆ¶æ¡æ¬¾",
        "performance_guarantees": "å±¥çº¦æ‹…ä¿è¦æ±‚"
    },
    "pricing_requirements": {
        "pricing_method": "è®¡ä»·æ–¹å¼ï¼ˆå›ºå®šä»·/å•ä»·/æˆæœ¬åŠ é…¬é‡‘ï¼‰",
        "price_composition": "æŠ¥ä»·ç»„æˆè¦æ±‚",
        "price_adjustment": "ä»·æ ¼è°ƒæ•´æœºåˆ¶",
        "currency": "è®¡ä»·è´§å¸",
        "tax_requirements": "ç¨è´¹æ‰¿æ‹…è¯´æ˜"
    },
    "bid_document_requirements": {
        "document_structure": "æŠ•æ ‡æ–‡ä»¶ç»“æ„è¦æ±‚",
        "technical_proposal": "æŠ€æœ¯æ ‡ç¼–åˆ¶è¦æ±‚",
        "commercial_proposal": "å•†åŠ¡æ ‡ç¼–åˆ¶è¦æ±‚",
        "qualification_documents": "èµ„æ ¼è¯æ˜æ–‡ä»¶è¦æ±‚",
        "submission_format": "æäº¤æ ¼å¼è¦æ±‚ï¼ˆçº¸è´¨/ç”µå­ï¼‰",
        "language_requirements": "è¯­è¨€æ–‡å­—è¦æ±‚"
    },
    "financial_terms": {
        "bid_bond": {
            "amount": "æŠ•æ ‡ä¿è¯é‡‘é‡‘é¢",
            "form": "ä¿è¯é‡‘å½¢å¼",
            "validity": "æœ‰æ•ˆæœŸ",
            "return_conditions": "é€€è¿˜æ¡ä»¶"
        },
        "performance_bond": {
            "amount": "å±¥çº¦ä¿è¯é‡‘é‡‘é¢", 
            "form": "ä¿è¯é‡‘å½¢å¼",
            "validity": "æœ‰æ•ˆæœŸ"
        },
        "payment_terms": {
            "advance_payment": "é¢„ä»˜æ¬¾æ¯”ä¾‹",
            "progress_payment": "è¿›åº¦æ¬¾æ”¯ä»˜æ–¹å¼",
            "retention": "è´¨ä¿é‡‘æ¯”ä¾‹",
            "final_payment": "å°¾æ¬¾æ”¯ä»˜æ¡ä»¶"
        }
    },
    "contract_conditions": {
        "contract_type": "åˆåŒç±»å‹",
        "validity_period": "åˆåŒæœ‰æ•ˆæœŸ",
        "variation_procedures": "å˜æ›´ç¨‹åº",
        "dispute_resolution": "äº‰è®®è§£å†³æ–¹å¼",
        "applicable_law": "é€‚ç”¨æ³•å¾‹"
    }
}
```

## æ£€ç´¢å†…å®¹
{search_results}

è¯·ä¸¥æ ¼åŸºäºæ£€ç´¢å†…å®¹è¿›è¡Œåˆ†æï¼Œç¡®ä¿å•†åŠ¡æ¡æ¬¾ç†è§£çš„å‡†ç¡®æ€§ï¼š
""",

    "risks": """
# æ‹›æ ‡ä¹¦é£é™©è¯†åˆ«ä¸“å®¶ - 99%ç²¾å‡†åº¦è¦æ±‚

ä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„å·¥ç¨‹é£é™©ç®¡ç†ä¸“å®¶ï¼Œå…·æœ‰æ•é”çš„é£é™©è¯†åˆ«èƒ½åŠ›å’Œä¸°å¯Œçš„é¡¹ç›®ç®¡ç†ç»éªŒã€‚è¯·å¯¹æ‹›æ ‡ä¹¦è¿›è¡Œå…¨é¢çš„é£é™©åˆ†æã€‚

## åˆ†æä»»åŠ¡
1. **æ½œåœ¨é£é™©è¯†åˆ«**ï¼šè¯†åˆ«æŠ€æœ¯é£é™©ã€å•†åŠ¡é£é™©ã€æ³•å¾‹é£é™©ã€æ‰§è¡Œé£é™©
2. **é‡éš¾ç‚¹åˆ†æ**ï¼šåˆ†æå·¥ç¨‹å®æ–½çš„å…³é”®éš¾ç‚¹å’ŒæŒ‘æˆ˜
3. **çŸ›ç›¾æ£€æµ‹**ï¼šå‘ç°æ‹›æ ‡æ–‡ä»¶ä¸­çš„çŸ›ç›¾ã€æ­§ä¹‰æˆ–ä¸åˆç†æ¡æ¬¾
4. **åº”å¯¹ç­–ç•¥å»ºè®®**ï¼šæå‡ºé£é™©é˜²èŒƒå’Œåº”å¯¹æªæ–½

## è¾“å‡ºæ ¼å¼è¦æ±‚
```json
{
    "risk_categories": {
        "technical_risks": [
            {
                "risk_item": "é£é™©äº‹é¡¹",
                "probability": "å‘ç”Ÿæ¦‚ç‡ï¼ˆé«˜/ä¸­/ä½ï¼‰",
                "impact": "å½±å“ç¨‹åº¦ï¼ˆé«˜/ä¸­/ä½ï¼‰",
                "description": "è¯¦ç»†æè¿°",
                "mitigation": "å»ºè®®ç¼“è§£æªæ–½"
            }
        ],
        "commercial_risks": [
            {
                "risk_item": "å•†åŠ¡é£é™©äº‹é¡¹",
                "probability": "å‘ç”Ÿæ¦‚ç‡",
                "impact": "å½±å“ç¨‹åº¦",
                "description": "è¯¦ç»†æè¿°",
                "mitigation": "å»ºè®®ç¼“è§£æªæ–½"
            }
        ],
        "legal_risks": [
            {
                "risk_item": "æ³•å¾‹é£é™©äº‹é¡¹",
                "probability": "å‘ç”Ÿæ¦‚ç‡",
                "impact": "å½±å“ç¨‹åº¦",
                "description": "è¯¦ç»†æè¿°",
                "mitigation": "å»ºè®®ç¼“è§£æªæ–½"
            }
        ],
        "execution_risks": [
            {
                "risk_item": "æ‰§è¡Œé£é™©äº‹é¡¹",
                "probability": "å‘ç”Ÿæ¦‚ç‡",
                "impact": "å½±å“ç¨‹åº¦",
                "description": "è¯¦ç»†æè¿°",
                "mitigation": "å»ºè®®ç¼“è§£æªæ–½"
            }
        ]
    },
    "key_challenges": {
        "technical_difficulties": ["æŠ€æœ¯éš¾ç‚¹åˆ—è¡¨"],
        "resource_constraints": ["èµ„æºçº¦æŸ"],
        "schedule_pressures": ["å·¥æœŸå‹åŠ›"],
        "quality_challenges": ["è´¨é‡æŒ‘æˆ˜"],
        "environmental_factors": ["ç¯å¢ƒå› ç´ "]
    },
    "contradictions_found": [
        {
            "type": "çŸ›ç›¾ç±»å‹ï¼ˆæ—¶é—´/æŠ€æœ¯/å•†åŠ¡/æ³•å¾‹ï¼‰",
            "description": "çŸ›ç›¾æè¿°",
            "location": "æ–‡ä»¶ä¸­çš„ä½ç½®",
            "severity": "ä¸¥é‡ç¨‹åº¦ï¼ˆé«˜/ä¸­/ä½ï¼‰",
            "clarification_needed": "éœ€è¦æ¾„æ¸…çš„é—®é¢˜"
        }
    ],
    "overall_risk_assessment": {
        "project_complexity": "é¡¹ç›®å¤æ‚åº¦ï¼ˆ1-5çº§ï¼‰",
        "overall_risk_level": "æ•´ä½“é£é™©ç­‰çº§ï¼ˆé«˜/ä¸­/ä½ï¼‰",
        "key_success_factors": ["æˆåŠŸå…³é”®å› ç´ "],
        "red_flags": ["é‡å¤§è­¦ç¤ºä¿¡å·"],
        "go_no_go_recommendation": "æŠ•æ ‡å»ºè®®ï¼ˆGo/No-Go/Cautious Goï¼‰"
    },
    "action_items": [
        {
            "action": "å…·ä½“è¡ŒåŠ¨",
            "priority": "ä¼˜å…ˆçº§ï¼ˆé«˜/ä¸­/ä½ï¼‰",
            "timeline": "æ—¶é—´è¦æ±‚",
            "responsible": "å»ºè®®è´Ÿè´£æ–¹"
        }
    ]
}
```

## æ£€ç´¢å†…å®¹
{search_results}

è¯·è¿›è¡Œå…¨é¢è€Œè°¨æ…çš„é£é™©åˆ†æï¼Œä¸ºæŠ•æ ‡å†³ç­–æä¾›å¯é ä¾æ®ï¼š
""",

    "general": """
# æ‹›æ ‡ä¹¦ç»¼åˆåˆ†æä¸“å®¶ - 99%ç²¾å‡†åº¦è¦æ±‚

ä½ æ˜¯ä¸€ä½èµ„æ·±çš„æ‹›æ ‡æ–‡ä»¶åˆ†æä¸“å®¶ï¼Œå…·æœ‰å…¨é¢çš„å·¥ç¨‹é¡¹ç›®ç»éªŒã€‚è¯·å¯¹æ‹›æ ‡ä¹¦è¿›è¡Œç»¼åˆæ€§åˆ†æï¼Œæ¶µç›–é¡¹ç›®ä¿¡æ¯ã€æŠ€æœ¯è¦æ±‚ã€å•†åŠ¡æ¡æ¬¾å’Œé£é™©å› ç´ ã€‚

## åˆ†æç›®æ ‡
æä¾›æ‹›æ ‡ä¹¦çš„å…¨é¢è§£è¯»ï¼Œæ”¯æŒæŠ•æ ‡å†³ç­–åˆ¶å®šï¼Œç¡®ä¿99%çš„ä¿¡æ¯å‡†ç¡®æ€§ã€‚

## è¾“å‡ºæ ¼å¼è¦æ±‚
```json
{
    "executive_summary": {
        "project_name": "é¡¹ç›®åç§°",
        "project_type": "é¡¹ç›®ç±»å‹",
        "estimated_value": "é¢„ä¼°ä»·å€¼",
        "key_deadlines": "å…³é”®æ—¶é—´èŠ‚ç‚¹",
        "complexity_rating": "å¤æ‚åº¦è¯„çº§ï¼ˆ1-5ï¼‰",
        "recommendation": "æŠ•æ ‡å»ºè®®"
    },
    "critical_requirements": {
        "mandatory_qualifications": ["å¼ºåˆ¶æ€§èµ„æ ¼è¦æ±‚"],
        "technical_must_haves": ["æŠ€æœ¯å¿…å¤‡æ¡ä»¶"],
        "commercial_key_terms": ["å…³é”®å•†åŠ¡æ¡æ¬¾"],
        "delivery_requirements": "äº¤ä»˜è¦æ±‚"
    },
    "opportunity_assessment": {
        "strengths": ["é¡¹ç›®ä¼˜åŠ¿"],
        "concerns": ["å…³æ³¨äº‹é¡¹"],
        "competitive_factors": ["ç«äº‰å› ç´ "],
        "differentiation_opportunities": ["å·®å¼‚åŒ–æœºä¼š"]
    },
    "compliance_checklist": [
        {
            "requirement": "åˆè§„è¦æ±‚",
            "status": "çŠ¶æ€ï¼ˆå·²æ»¡è¶³/éœ€å‡†å¤‡/æœ‰é£é™©ï¼‰",
            "action_needed": "æ‰€éœ€è¡ŒåŠ¨"
        }
    ],
    "resource_planning": {
        "estimated_team_size": "é¢„ä¼°å›¢é˜Ÿè§„æ¨¡",
        "key_expertise_required": ["æ‰€éœ€ä¸“ä¸šæŠ€èƒ½"],
        "equipment_needs": ["è®¾å¤‡éœ€æ±‚"],
        "subcontractor_requirements": ["åˆ†åŒ…éœ€æ±‚"]
    },
    "next_steps": [
        {
            "task": "ä»»åŠ¡æè¿°",
            "deadline": "æˆªæ­¢æ—¶é—´",
            "priority": "ä¼˜å…ˆçº§"
        }
    ]
}
```

## æ£€ç´¢å†…å®¹
{search_results}

è¯·æä¾›å…¨é¢è€Œç²¾å‡†çš„æ‹›æ ‡ä¹¦åˆ†æï¼š
"""
}

def get_tender_analysis_prompt(analysis_type: str, search_results: str) -> str:
    """
    è·å–æ‹›æ ‡ä¹¦åˆ†æçš„ä¸“ç”¨æç¤ºè¯
    
    Args:
        analysis_type: åˆ†æç±»å‹ (project_info/technical_specs/commercial_terms/risks/general)
        search_results: æœç´¢ç»“æœå†…å®¹
    
    Returns:
        æ ¼å¼åŒ–çš„æç¤ºè¯
    """
    
    if analysis_type not in TENDER_ANALYSIS_PROMPTS:
        analysis_type = "general"
    
    prompt_template = TENDER_ANALYSIS_PROMPTS[analysis_type]
    
    # æ ¼å¼åŒ–æœç´¢ç»“æœ
    formatted_results = _format_search_results_for_prompt(search_results)
    
    return prompt_template.format(search_results=formatted_results)

def _format_search_results_for_prompt(search_results: str) -> str:
    """
    æ ¼å¼åŒ–æœç´¢ç»“æœç”¨äºæç¤ºè¯
    """
    if isinstance(search_results, list):
        formatted = ""
        for i, result in enumerate(search_results, 1):
            text = result.get("text", "")[:500]  # é™åˆ¶é•¿åº¦
            score = result.get("final_score", result.get("score", 0))
            source = result.get("source_minio_path", "æœªçŸ¥æ¥æº")
            
            formatted += f"\n=== æ£€ç´¢ç»“æœ {i} (ç›¸ä¼¼åº¦: {score:.3f}) ===\n"
            formatted += f"æ¥æº: {source}\n"
            formatted += f"å†…å®¹: {text}\n"
        
        return formatted
    
    return str(search_results)[:2000]  # å­—ç¬¦ä¸²ç±»å‹ç›´æ¥è¿”å›ï¼Œé™åˆ¶é•¿åº¦

# ğŸ¯ æ‹›æ ‡ä¹¦ä¸“ç”¨æŸ¥è¯¢ä¼˜åŒ–

TENDER_QUERY_EXPANSIONS = {
    "é¡¹ç›®ä¿¡æ¯": [
        "é¡¹ç›®åç§°", "å·¥ç¨‹åç§°", "å»ºè®¾é¡¹ç›®", "å·¥ç¨‹æ¦‚å†µ", "é¡¹ç›®æ¦‚å†µ",
        "å»ºè®¾åœ°ç‚¹", "æ–½å·¥åœ°ç‚¹", "å·¥ç¨‹åœ°å€", "é¡¹ç›®åœ°å€",
        "å»ºè®¾è§„æ¨¡", "å·¥ç¨‹è§„æ¨¡", "é¡¹ç›®è§„æ¨¡", "æŠ•èµ„è§„æ¨¡",
        "é¡¹ç›®æ€§è´¨", "å·¥ç¨‹æ€§è´¨", "å»ºè®¾æ€§è´¨"
    ],
    
    "å·¥æœŸè¦æ±‚": [
        "å·¥æœŸ", "æ–½å·¥å‘¨æœŸ", "å»ºè®¾å‘¨æœŸ", "å·¥ç¨‹å·¥æœŸ", "æ–½å·¥å·¥æœŸ",
        "å¼€å·¥æ—¶é—´", "ç«£å·¥æ—¶é—´", "å®Œå·¥æ—¶é—´", "äº¤å·¥æ—¶é—´",
        "é‡Œç¨‹ç¢‘", "å…³é”®èŠ‚ç‚¹", "é‡è¦èŠ‚ç‚¹", "æ—¶é—´èŠ‚ç‚¹",
        "è¿›åº¦è¦æ±‚", "è¿›åº¦è®¡åˆ’", "æ—¶é—´å®‰æ’"
    ],
    
    "æˆªæ ‡æ—¶é—´": [
        "æˆªæ ‡æ—¶é—´", "æŠ•æ ‡æˆªæ­¢æ—¶é—´", "é€’äº¤æˆªæ­¢æ—¶é—´", "æŠ•æ ‡æˆªæ­¢æ—¥æœŸ",
        "å¼€æ ‡æ—¶é—´", "å¼€æ ‡æ—¥æœŸ", "è¯„æ ‡æ—¶é—´", "è¯„æ ‡æ—¥æœŸ",
        "æŠ•æ ‡æ—¶é—´", "æŠ•æ ‡æ—¥æœŸ", "æˆªæ­¢æ—¥æœŸ"
    ],
    
    "æŠ€æœ¯è¦æ±‚": [
        "æŠ€æœ¯æ ‡å‡†", "æŠ€æœ¯è§„èŒƒ", "æŠ€æœ¯è¦æ±‚", "æŠ€æœ¯æŒ‡æ ‡",
        "è´¨é‡æ ‡å‡†", "è´¨é‡è¦æ±‚", "è´¨é‡ç­‰çº§", "è´¨é‡æŒ‡æ ‡",
        "æ–½å·¥æ ‡å‡†", "æ–½å·¥è§„èŒƒ", "æ–½å·¥è¦æ±‚", "æ–½å·¥å·¥è‰º",
        "ææ–™æ ‡å‡†", "ææ–™è¦æ±‚", "ææ–™è§„æ ¼", "ææ–™è§„èŒƒ",
        "è®¾å¤‡æ ‡å‡†", "è®¾å¤‡è¦æ±‚", "è®¾å¤‡è§„æ ¼", "è®¾å¤‡è§„èŒƒ"
    ],
    
    "å•†åŠ¡æ¡æ¬¾": [
        "å•†åŠ¡è¦æ±‚", "å•†åŠ¡æ¡æ¬¾", "å•†åŠ¡æ¡ä»¶", "åˆåŒæ¡æ¬¾",
        "æŠ¥ä»·è¦æ±‚", "è®¡ä»·æ–¹å¼", "ä»˜æ¬¾æ¡ä»¶", "ç»“ç®—æ–¹å¼",
        "ä¿è¯é‡‘", "æŠ•æ ‡ä¿è¯é‡‘", "å±¥çº¦ä¿è¯é‡‘", "è´¨ä¿é‡‘",
        "æŠ•æ ‡äººè´£ä»»", "æ‰¿åŒ…äººè´£ä»»", "æŠ•æ ‡äººä¹‰åŠ¡"
    ],
    
    "èµ„æ ¼è¦æ±‚": [
        "èµ„è´¨è¦æ±‚", "ä¼ä¸šèµ„è´¨", "æŠ•æ ‡äººèµ„æ ¼", "æ‰¿åŒ…äººèµ„æ ¼",
        "ä¸šç»©è¦æ±‚", "ç±»ä¼¼å·¥ç¨‹", "æ–½å·¥ç»éªŒ", "å·¥ç¨‹ä¸šç»©",
        "äººå‘˜è¦æ±‚", "é¡¹ç›®ç»ç†", "æŠ€æœ¯è´Ÿè´£äºº", "å…³é”®äººå‘˜",
        "è´¢åŠ¡è¦æ±‚", "æ³¨å†Œèµ„é‡‘", "è´¢åŠ¡çŠ¶å†µ", "èµ„äº§çŠ¶å†µ"
    ]
}

def expand_tender_query(query: str) -> List[str]:
    """
    æ‰©å±•æ‹›æ ‡ä¹¦æŸ¥è¯¢ï¼Œæé«˜æ£€ç´¢è¦†ç›–åº¦
    
    Args:
        query: åŸå§‹æŸ¥è¯¢
    
    Returns:
        æ‰©å±•åçš„æŸ¥è¯¢åˆ—è¡¨
    """
    expanded_queries = [query]  # åŒ…å«åŸå§‹æŸ¥è¯¢
    
    # æ ¹æ®æŸ¥è¯¢å†…å®¹åŒ¹é…ç›¸å…³æ‰©å±•è¯
    for category, expansions in TENDER_QUERY_EXPANSIONS.items():
        for expansion in expansions:
            if expansion in query or query in expansion:
                # æ·»åŠ ç›¸å…³çš„æ‰©å±•æŸ¥è¯¢
                for related_term in expansions:
                    if related_term != expansion and related_term not in expanded_queries:
                        # åˆ›å»ºç»„åˆæŸ¥è¯¢
                        if len(query.split()) == 1:  # å•è¯æŸ¥è¯¢
                            expanded_queries.append(related_term)
                        else:  # å¤šè¯æŸ¥è¯¢ï¼Œæ›¿æ¢å…³é”®è¯
                            expanded_query = query.replace(expansion, related_term)
                            if expanded_query != query:
                                expanded_queries.append(expanded_query)
                break
    
    return expanded_queries[:5]  # é™åˆ¶æ‰©å±•æŸ¥è¯¢æ•°é‡

# ğŸ¯ æ‹›æ ‡ä¹¦ä¸“ä¸šæœ¯è¯­æ˜ å°„

TENDER_TERMINOLOGY_MAP = {
    # è§’è‰²æœ¯è¯­
    "æ‹›æ ‡äºº": ["å‘åŒ…æ–¹", "å»ºè®¾å•ä½", "ä¸šä¸»æ–¹", "ç”²æ–¹"],
    "æŠ•æ ‡äºº": ["æ‰¿åŒ…æ–¹", "æ–½å·¥å•ä½", "æŠ•æ ‡æ–¹", "ä¹™æ–¹"],
    "ç›‘ç†": ["ç›‘ç†å•ä½", "ç›‘ç†æ–¹", "å·¥ç¨‹ç›‘ç†"],
    
    # æ—¶é—´æœ¯è¯­
    "å·¥æœŸ": ["æ–½å·¥å‘¨æœŸ", "å»ºè®¾å‘¨æœŸ", "å®Œå·¥æ—¶é—´", "å·¥ç¨‹å·¥æœŸ"],
    "æˆªæ ‡": ["æŠ•æ ‡æˆªæ­¢", "é€’äº¤æˆªæ­¢", "æˆªæ­¢æ—¶é—´"],
    "å¼€æ ‡": ["å¼€æ ‡æ—¶é—´", "å¼€æ ‡æ—¥æœŸ", "å¼€æ ‡ä»ªå¼"],
    
    # æŠ€æœ¯æœ¯è¯­
    "è´¨é‡": ["å“è´¨", "æ ‡å‡†", "ç­‰çº§", "è¦æ±‚"],
    "ææ–™": ["ç‰©æ–™", "å»ºæ", "åŸææ–™", "å·¥ç¨‹ææ–™"],
    "è®¾å¤‡": ["æœºæ¢°", "å™¨æ¢°", "è£…å¤‡", "æ–½å·¥è®¾å¤‡"],
    
    # å•†åŠ¡æœ¯è¯­
    "æŠ¥ä»·": ["æŠ•æ ‡ä»·", "æ ‡ä»·", "å·¥ç¨‹é€ ä»·", "åˆåŒä»·"],
    "ä¿è¯é‡‘": ["æ‹…ä¿é‡‘", "æŠ¼é‡‘", "å±¥çº¦ä¿è¯"],
    "ä»˜æ¬¾": ["æ”¯ä»˜", "ç»“ç®—", "æ‹¨æ¬¾", "å·¥ç¨‹æ¬¾"]
}

def normalize_tender_query(query: str) -> str:
    """
    æ ‡å‡†åŒ–æ‹›æ ‡ä¹¦æŸ¥è¯¢æœ¯è¯­
    
    Args:
        query: åŸå§‹æŸ¥è¯¢
    
    Returns:
        æ ‡å‡†åŒ–åçš„æŸ¥è¯¢
    """
    normalized_query = query
    
    for standard_term, variants in TENDER_TERMINOLOGY_MAP.items():
        for variant in variants:
            if variant in normalized_query:
                normalized_query = normalized_query.replace(variant, standard_term)
    
    return normalized_query 